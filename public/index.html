<html>
  <head>
    <title>Interview Prep</title>
    <link rel="stylesheet" href="stylesheets/application.css" media="all">

    <script src="https://fb.me/react-with-addons-0.13.3.js"></script>
    <script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
    <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
  </head>
  <body>
      <div class="col-4-5 f-right">
        <div class="col-5-5 header black">
          <h2>PrApp</h2>
        </div>
        <div id="content" class="col-5-5 black">

        </div>

        <div class="col-5-5 footer black">

        </div>
      </div>

      <div class="col-1-5">
        <div class="col-5-5 header white">

        </div>
        <div id="timer" class="col-5-5 box gray1">

        </div>
        <div class="col-5-5 box gray2">

        </div>
        <div class="col-5-5 box gray3">

        </div>
        <div class="col-5-5 box gray4">

        </div>
        <div class="col-5-5 footer gray5">

        </div>
      </div>

    <!-- <div id="content"></div> -->
    <!-- <div id="timer"></div> -->
    <script type="text/jsx">

    var QOrA = "";
    var quest = 0;
    var inputVal = "";


    var PrepApp = React.createClass({
      loadQuestionsFromServer: function() {
        $.ajax({
          url: this.props.url,
          dataType: 'json',
          cache: false,
          success: function(data) {
            this.setState({data: data.questions});
          }.bind(this),
          error: function(xhr, status, err) {
            console.error(this.props.url, status, err.toString());
          }.bind(this)
        });
      },
      getInitialState: function() {
        return{answered: false, value: "Start", question: quest, data: [], array:[]};
      },
      componentDidMount: function() {
        this.loadQuestionsFromServer();
        // setInterval(this.loadQuestionsFromServer, this.props.pollInterval);
      },
      // componentWillMount: function(){
      //   this.loadQuestionsFromServer();
      //   // setInterval(this.loadQuestionsFromServer, this.props.pollInterval);
      // },
      handleSubmit: function(e){
        e.preventDefault();

        if(array.length === 0 && this.state.value === "See Answer"){
          return;
          }else if(this.state.value === "Start" && this.state.answered === false){
          this.setState({value:"See Answer"});
          questionNodes(this.state);
        } else if(this.state.value === "See Answer"){
          $('input[id=next]').prop( "disabled", true );
          this.setState({answered: true});
          this.setState({value:"Next Question"});
        } else if (this.state.answered === false){
          this.setState({answered: true});
          this.setState({value:"Next Question"});
        } else if (this.state.answered === true){
          var DomState = this.state.data;
          var dbUpdate = {};
          if (DomState){
            DomState.map(function (question){
            if (question.correct === true){
              dbUpdate = question;
            }
            return(
              <div>
                {dbUpdate}
              </div>
            );
          });
        }
          this.setState({answered: false});
          this.setState({value:"See Answer"});
          this.setState({value:"See Answer"});
          questionNodes(this.state);
          // this.setState({data: data.questions});

          // $.ajax({
          //         url: this.props.url + "/" + dbUpdate.id,
          //         dataType: 'json',
          //         type: 'PATCH',
          //         accept: "application/json",
          //         data: {question:{correct: dbUpdate.correct}},
          //         success: function(data) {
          //           questionNodes(this.state);
          //           this.setState({data: data.questions});
          //         }.bind(this),
          //         error: function(xhr, status, err) {
          //           console.error(this.props.url, status, err.toString());
          //         }.bind(this)
          //       });
        }
      },
      render: function(){

        if (this.state.answered === false && this.state.value === "Start"){
          QOrA = <PrepStart />;
        } else if (this.state.answered === false && array.length === 0 && this.state.value === "See Answer"){
          QOrA = <PrepEnd />;
        } else if (this.state.answered === false && this.state.value === "See Answer"){
          QOrA = <PrepQuestion data={this.state.data}/>;
        } else if (this.state.answered === false){
          QOrA = <PrepQuestion data={this.state.data}/>;
        } else if (this.state.answered === true){
          QOrA = <PrepAnswer />;
        }

        return(
          <div className="prep-app">
          {QOrA}
          <hr></hr>
          <form onSubmit={this.handleSubmit}>
            <input id="next" type="submit" value={this.state.value}/>
          </form>
          </div>
        )
      }
    });

    var PrepStart = React.createClass({
      render: function(){
        return(
          <h1>
          Start your interview PrApperation.
          You can thank me later!
          </h1>
        )
      }
    });

    var PrepEnd = React.createClass({
      render: function(){
        return(
          <h1>
            Congrats Youre done!
          </h1>
        )
      }
    });

    var PrepQuestion = React.createClass({
      getInitialState: function(){
        return{question: quest};
      },
      render: function(){

        // questionNodes(this.state.data);
        var arrayData = this.props.data
        if (arrayData != []){
          return(
            <div className="prep-question">
            <h1>{array[this.state.question].question}</h1>
            </div>
          )

        }
      }
    });

    var PrepAnswer = React.createClass({
      getInitialState: function(){
        return{question: quest};
      },
      handleUpSubmit: function(e){
        e.preventDefault();

        array[this.state.question].correct = true;
        this.setState({answered: true});

        $('input[id=up]').prop( "disabled", true );
        $('input[id=down]').prop( "disabled", false );
        $('input[id=next]').prop( "disabled", false );

      },
      handleDownSubmit: function(e){
        e.preventDefault();

        array[this.state.question].correct = false;
        this.setState({answered: true});

        $('input[id=up]').prop( "disabled", false );
        $('input[id=down]').prop( "disabled", true );
        $('input[id=next]').prop( "disabled", false );

      },
      render: function(){
        return(
          <div className="prep-answer">
            <h1>{array[this.state.question].answer}</h1>
            <form onSubmit={this.handleUpSubmit}>
              <input id="up" type="submit" value="up"/>
            </form>
            <form onSubmit={this.handleDownSubmit}>
              <input id="down" type="submit" value="down"/>
            </form>
          </div>
        )
      }
    });

    // var data = [
    //   {question: "Color?", answer: "red", correct: false},
    //   {question: "Dog?", answer: "poodle", correct: false},
    //   {question: "Food?", answer: "Pizza", correct: false},
    //   {question: "Shake?", answer: "Chocolate", correct: false}
    // ];

    var array = [];
    var questionNodes = function(state){
      array = []
      var d = state.data;
      if (d){
        d.map(function (question){
          console.log(question);
        if (question.correct === false){
          array.push(question)
        }
        return(
          <div>
            {shuffle(array)}
          </div>
        );
      });
    }
  };

  function shuffle(array) {
  var num = array.length, t, index;

  while (num) {
    index = Math.floor(Math.random() * num--);
    t = array[num];
    array[num] = array[index];
    array[index] = t;
  }
    return array;
  }

  React.render(<PrepApp url="http://localhost:3000/questions" />, document.getElementById('content'));


  // Timer Component 2
  var Timer = React.createClass({
    getInitialState: function() {
      return {secondsElapsed: 0};
    },
    tick: function() {
      this.setState({secondsElapsed: this.state.secondsElapsed + 1});
    },
    componentDidMount: function() {
      this.interval = setInterval(this.tick, 1000);
    },
    componentWillUnmount: function() {
      clearInterval(this.interval);
    },
    render: function() {
      return (
        <div>Seconds Elapsed: {this.state.secondsElapsed}</div>
      );
    }
  });

  var mountNode = document.getElementById('timer')
  React.render(<Timer />, mountNode);

    </script>
  </body>
</html>
